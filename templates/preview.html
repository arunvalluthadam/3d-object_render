{% include 'base.html' %}

{% block css %}
	<style>
		body {
			/*font-family: Monospace;
			background-color: #000;
			color: #fff;
			margin: 0px;
			overflow: hidden;*/
		}
		#info {
			color: #fff;
			position: absolute;
			top: 10px;
			width: 100%;
			text-align: center;
			z-index: 100;
			display:block;
		}
		#info a, .button { color: #f00; font-weight: bold; text-decoration: underline; cursor: pointer }
	</style>
{% endblock %}

{% block content %}
	<div class="container">
    	<br>
    	<h3>
    		"W" translate | "E" rotate | "R" scale | "+" increase size | "-" decrease size
    	</h3>
    </div>

	<div id="container"></div>

	<div class="container">
    	<!-- <button class="btn btn-danger" onclick="save()">Save</button> -->
    	<a class="btn btn-danger" onclick="save()" href="/gallery">Save</a>
    </div>
    
{% endblock %}

{% block js %}
	<script src="/static/js/three_render/three.min.js"></script>
	<script src="/static/js/three_render/OBJLoader.js"></script>
    <script src="/static/js/three_render/Detector.js"></script>
    <script src="/static/js/three_render/DragControls.js"></script>
    <script src="/static/js/three_render/OrbitControls.js"></script>
    <script src="/static/js/three_render/TrackballControls.js"></script>
    <script src="/static/js/three_render/TransformControls.js"></script>

    <script src="/static/js/three_render/stats.min.js"></script>

	<script type="text/javascript">
		var container, stats;

        var camera, scene, renderer;

        var coorninates = {};



        init();
        animate();


        function init() {

            var container = document.getElementById('container');

            camera = new THREE.PerspectiveCamera( 45, window.innerWidth / window.innerHeight, 1, 200000 );
            camera.position.set( 1000, 500, 1000 );
            // camera.position.z = 1200;
            // coorninates.camera_pos = 1200;
            // scene

            scene = new THREE.Scene();

            var ambient = new THREE.AmbientLight( 0x404040 ); // 0x101030
            scene.add( ambient );

            // light from left side of the object
            var directionalLight = new THREE.DirectionalLight( 0xffeedd );
            directionalLight.position.set( 2000, 0, 0 ).normalize();
            scene.add( directionalLight );

            // light from right side of the object
            var directionalLight = new THREE.DirectionalLight( 0xffeedd );
            directionalLight.position.set( -1000, 0, 0 ).normalize();
            scene.add( directionalLight );

            // var directionalLight = new THREE.DirectionalLight( 0xffeedd );
            // directionalLight.position.set( 10, 3, 0 ).normalize();
            // scene.add( directionalLight );

            // var directionalLight = new THREE.DirectionalLight( 0xffeedd );
            // directionalLight.position.set( -100, 3, 0 ).normalize();
            // scene.add( directionalLight );

            // var directionalLight = new THREE.DirectionalLight( 0xffeedd );
            // directionalLight.position.set( 3, 100, 10 ).normalize();
            // scene.add( directionalLight );

            //  var directionalLight = new THREE.DirectionalLight( 0xffeedd );
            // directionalLight.position.set( 5, -5, 0 ).normalize();
            // scene.add( directionalLight );


            renderer = new THREE.WebGLRenderer();
            renderer.setSize( window.innerWidth, window.innerHeight );
            container.appendChild( renderer.domElement );

            // model

            // var obj_loader_pos;
            var loader = new THREE.OBJLoader();
            var obj_loader = loader.load( "/media/{{last_one.obj_file}}", function ( object ) {
            	var control = new THREE.TransformControls(camera, renderer.domElement);
            	control.addEventListener('change', render);
            	scene.add( object );
            	control.attach(object);
            	scene.add(control);

            	window.addEventListener( 'keydown', function ( event ) {
			            //console.log(event.which);
			            switch ( event.keyCode ) {
			              case 81: // Q
			                control.setSpace( control.space == "local" ? "world" : "local" );
			                break;
			              case 87: // W
			                control.setMode( "translate" );
			                break;
			              case 69: // E
			                control.setMode( "rotate" );
			                break;
			              case 82: // R
			                control.setMode( "scale" );
			                break;
						case 187:
						case 107: // +,=,num+
							control.setSize( control.size + 0.1 );
							break;
						case 189:
						case 109: // -,_,num-
							control.setSize( Math.max(control.size - 0.1, 0.1 ) );
							break;
			            }
	        		});
            } );


            //

            controls = new THREE.OrbitControls( camera, renderer.domElement );
            controls.target.set(0, 0, 0);

            // coorninates.cod_x = 200;
            // coorninates.cod_x = 200;
            // coorninates.cod_x = -100;

            console.log(JSON.stringify(coorninates));
            window.addEventListener( 'resize', onWindowResize, false );

        }

        function onWindowResize() {

            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();

            renderer.setSize( window.innerWidth, window.innerHeight );

        }

        //

        function animate() {

            requestAnimationFrame( animate );

            controls.update();
            
            render();

        }

        function render() {


            renderer.render( scene, camera );

        }

	</script>


	<script>
		function save() {
			alert(JSON.stringify(coorninates));
			$.post("/preview/", {'whole_data': JSON.stringify(coorninates)});
			alert("Content Saved !!!");
		}
		
	</script>
{% endblock %}